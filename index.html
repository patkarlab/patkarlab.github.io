<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Molecular Hematology Research Group</title>
  <style>
    html, body { margin:0; padding:0; height:100%; }
    /* Canvas stays behind everything */
    #nucleotideCanvas{
      position:fixed; inset:0; z-index:0; display:block; pointer-events:none;
    }
    /* Top navigation */
    .topnav{
      position:fixed; top:12px; left:16px; right:16px; z-index:3;
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .topnav a{
      text-decoration:none; font-weight:600;
      color: rgb(10,30,120);
      background: rgba(255,255,255,.85);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 2px 10px rgba(10,30,120,.12);
    }
    .wrap{
      position:relative; z-index:1; min-height:100vh;
      display:grid; place-items:center; padding:24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: rgb(10,30,120); text-align:center;
    }
    .card{
      background: rgba(255,255,255,0.85);
      -webkit-backdrop-filter: blur(2px); backdrop-filter: blur(2px);
      border-radius: 20px; padding: clamp(20px,4vw,48px);
      box-shadow: 0 12px 30px rgba(10,30,120,.10);
      max-width: 1100px; width: min(92vw, 1100px);
    }
    h1 { margin: 0 0 8px; font-size: clamp(28px,5vw,64px); line-height:1.1; }
    p  { margin: 10px 0; font-size: clamp(15px,2vw,20px); line-height: 1.6; }
  </style>
</head>
<body>

  <!-- Fixed top navigation -->
    <nav class="topnav" aria-label="Primary">
    <a href="about.html">About</a>
    <a href="research.html">Research</a>
    <a href="alumni.html">Research Group Alumni</a>
    <a href="gallery.html">Gallery</a>
  </nav>

  <!-- Background animation -->
  <canvas id="nucleotideCanvas"></canvas>

  <!-- Foreground content -->
  <main class="wrap">
    <section class="card" id="textBlock">
      <h1>Molecular Hematology Research Group</h1>
      <p>Our mission is to improve the diagnosis, prognostication and monitoring of acute leukaemia and rapidly translate these discoveries into the clinics.</p>
    </section>
  </main>

  <!-- Animation script -->
  <script>
  const canvas = document.getElementById("nucleotideCanvas");
  const ctx = canvas.getContext("2d");

  // === Controls you can tweak ===
  const SPEED_FACTOR = 0.5;     // overall fall speed (lower = slower)
  const LIFETIME_MS  = 2800;    // trail lifetime
  const MUT_RATE     = 0.03;    // mutation chance
  const COL_WIDTH    = 24;      // wider columns also help readability
  const ROW_SCALE_MIN = 1.25;   // vertical spacing = fontSize * random scale
  const ROW_SCALE_MAX = 1.6;    // increase these to spread letters out more

  // HiDPI crispness
  function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resizeCanvas();

  const bases = ["A","T","G","C"];
  let columns = [];
  let safeRect = null; // no-draw zone around the text

  function updateSafeRect(){
    const el = document.getElementById('textBlock');
    if(!el){ safeRect = null; return; }
    const r = el.getBoundingClientRect();
    const pad = 12; // small buffer
    safeRect = { left: r.left - pad, right: r.right + pad, top: r.top - pad, bottom: r.bottom + pad };
  }
  updateSafeRect();

  function inSafeRect(x,y){
    if(!safeRect) return false;
    return x >= safeRect.left && x <= safeRect.right && y >= safeRect.top && y <= safeRect.bottom;
  }

  function rand(a,b){ return a + Math.random()*(b-a); }

  function newColumn(i) {
    const fontSize = 16 + Math.random() * 24; // 16â€“40px
    const rowScale = rand(ROW_SCALE_MIN, ROW_SCALE_MAX);
    return {
      x: i * COL_WIDTH + Math.floor(COL_WIDTH * 0.5),
      y: Math.random() * window.innerHeight,
      speed: (0.9 + Math.random() * 1.4) * SPEED_FACTOR,
      fontSize,
      rowStep: fontSize * rowScale,
      depth: 0.7 + Math.random() * 1.1,
      lastEmitY: 0,
      trail: []
    };
  }

  function rebuildColumns() {
    const count = Math.max(1, Math.floor(window.innerWidth / COL_WIDTH));
    columns = new Array(count).fill(0).map((_, i) => {
      const c = newColumn(i);
      c.lastEmitY = c.y;
      return c;
    });
  }
  rebuildColumns();

  const easeOutQuad = t => 1 - (1 - t) * (1 - t);

  function draw(now) {
    // white background
    ctx.globalAlpha = 1;
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);

    columns.forEach((col, idx) => {
      col.y += col.speed * col.depth;

      while (col.y - col.lastEmitY >= col.rowStep) {
        col.lastEmitY += col.rowStep;

        const char = bases[(Math.random() * bases.length) | 0];
        const isMut = Math.random() < MUT_RATE;

        col.trail.push({
          x: col.x,
          y: col.lastEmitY,
          char,
          color: isMut ? "#D80000" : "rgb(10,30,120)",
          size: col.fontSize,
          born: now
        });
      }

      if (col.y > window.innerHeight + col.rowStep) {
        const next = newColumn(idx);
        next.y = 0;
        next.lastEmitY = -next.rowStep;
        columns[idx] = next;
      }

      const alive = [];
      for (let i = 0; i < col.trail.length; i++) {
        const g = col.trail[i];
        const age = now - g.born;
        if (age <= LIFETIME_MS) {
          const t = age / LIFETIME_MS;
          const alpha = 1 - easeOutQuad(t);

          // Skip drawing inside the safe text area
          if (!inSafeRect(g.x, g.y)) {
            ctx.globalAlpha = alpha;
            ctx.shadowColor = g.color;
            ctx.shadowBlur = Math.max(0, (g.size - 16) * 0.2);
            ctx.font = `${g.size}px monospace`;
            ctx.fillStyle = g.color;
            ctx.fillText(g.char, g.x, g.y);
          }
          alive.push(g);
        }
      }
      col.trail = alive;
    });

    ctx.globalAlpha = 1;
    ctx.shadowBlur = 0;
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);

  window.addEventListener("resize", () => {
    resizeCanvas();
    rebuildColumns();
    updateSafeRect();
  });
  window.addEventListener("load", updateSafeRect);
  </script>
</body>
</html>
